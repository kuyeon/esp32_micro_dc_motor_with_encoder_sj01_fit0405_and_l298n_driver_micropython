# 모터 개발자 도구 - GUI 버전

ESP32와 UART 통신을 통해 FIT0405 모터를 제어하는 PyQt5 기반 GUI 도구입니다.

## 🚀 설치 및 설정

### 1. Python 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. ESP32 설정
1. `esp32_motor_server.py`를 ESP32에 업로드
2. `fit0405_motor.py`도 ESP32에 업로드
3. ESP32를 PC에 USB로 연결 (COM3 포트)

### 3. 하드웨어 연결
```
ESP32    L298N 드라이버    FIT0405 모터
GPIO 2   -> IN1
GPIO 4   -> IN2  
GPIO 5   -> ENA
GPIO 18  -> ENB
GPIO 19  -> 엔코더 A
GPIO 21  -> 엔코더 B
```

## 🖥️ GUI 실행

```bash
python motor_developer_gui.py
```

## 📋 주요 기능

### 1. 기본 제어 탭
- **UART 연결**: 포트 및 보드레이트 설정
- **모터 제어**: 정방향/역방향/정지
- **엔코더 테스트**: 수동 회전 테스트
- **실시간 상태**: 현재 RPM, 위치, 방향 표시

### 2. PID 튜닝 탭
- **PID 파라미터**: Kp, Ki, Kd 실시간 조정
- **속도 제어**: 목표 RPM 설정 및 테스트
- **자동 튜닝**: 여러 설정 자동 테스트
- **프리셋**: 보수적/균형/적극적 설정

### 3. 위치 제어 탭
- **위치 이동**: 목표 위치 설정 및 이동
- **허용 오차**: 정확도 설정
- **다중 테스트**: 여러 위치 자동 테스트

### 4. 분석 탭
- **성능 분석**: 통계 계산 및 표시
- **데이터 관리**: 저장/초기화 기능
- **결과 테이블**: 상세 분석 결과

### 5. 실시간 그래프
- **목표 vs 실제**: RPM 비교 그래프
- **자동 스케일**: 그래프 자동 조정
- **실시간 업데이트**: 100ms마다 데이터 갱신

## 🔧 사용 방법

### 1. UART 연결
1. ESP32가 연결된 COM 포트 선택
2. 보드레이트 설정 (기본: 115200)
3. "연결" 버튼 클릭

### 2. 기본 모터 제어
1. 속도 설정 (0-100%)
2. 정방향/역방향 버튼 클릭
3. "정지" 버튼으로 모터 정지

### 3. PID 속도 제어
1. PID 파라미터 설정 (Kp, Ki, Kd)
2. 목표 RPM 설정
3. "PID 제어 시작" 버튼 클릭
4. 실시간 그래프에서 성능 확인

### 4. 자동 PID 튜닝
1. "자동 PID 튜닝" 버튼 클릭
2. 여러 파라미터 조합 자동 테스트
3. 최적 설정 자동 추천

### 5. 위치 제어
1. 목표 위치 설정
2. 허용 오차 설정
3. "위치로 이동" 버튼 클릭

## 📊 데이터 저장

- **CSV 형식**: 시간, 목표 RPM, 실제 RPM, PID 파라미터, 위치
- **저장 위치**: 사용자가 선택한 경로
- **분석**: Excel이나 다른 도구로 추가 분석 가능

## ⚠️ 주의사항

1. **UART 연결**: ESP32와 PC가 올바르게 연결되어 있는지 확인
2. **포트 설정**: 올바른 COM 포트와 보드레이트 사용
3. **하드웨어**: 모터와 엔코더 연결 상태 확인
4. **전원**: 모터에 충분한 전원 공급

## 🐛 문제 해결

### UART 연결 실패
- COM 포트가 올바른지 확인
- ESP32가 정상적으로 부팅되었는지 확인
- 다른 프로그램에서 포트를 사용 중인지 확인

### 모터가 움직이지 않음
- 하드웨어 연결 상태 확인
- 전원 공급 상태 확인
- ESP32 코드가 정상적으로 실행 중인지 확인

### 그래프가 업데이트되지 않음
- UART 연결 상태 확인
- ESP32에서 데이터가 정상적으로 전송되는지 확인

## 📁 파일 구조

```
├── motor_developer_gui.py      # PC용 GUI 프로그램
├── esp32_motor_server.py       # ESP32용 서버 코드
├── fit0405_motor.py           # 모터 제어 라이브러리
├── requirements.txt           # Python 패키지 목록
└── README_GUI.md             # 사용법 설명서
```

## 🔄 통신 프로토콜

### PC → ESP32 (명령)
```json
{
  "command": "forward",
  "data": {"speed": 50},
  "timestamp": 1234567890.123
}
```

### ESP32 → PC (응답)
```json
{
  "success": true,
  "data": {"rpm": 45.2},
  "message": "정방향 회전 시작",
  "timestamp": 1234567890.123
}
```

## 🎯 지원 명령어

- `forward`: 정방향 회전
- `backward`: 역방향 회전
- `stop`: 모터 정지
- `reset_position`: 위치 리셋
- `get_position`: 현재 위치 조회
- `get_rpm`: 현재 RPM 조회
- `get_direction`: 현재 방향 조회
- `set_speed_pid`: 속도 PID 파라미터 설정
- `set_position_pid`: 위치 PID 파라미터 설정
- `control_speed_pid`: PID 속도 제어
- `control_position_pid`: PID 위치 제어
- `get_status`: 전체 상태 조회
- `ping`: 연결 확인
